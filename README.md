# Лабораторная 2

**Цель работы:** разработка структуры базы данных и ее подключение к бэкенду

**Порядок показа:**
1.  Показать панель администратора Django/adminer, в которой добавить новую услугу, посмотреть данные через select в БД.
2.  Показать 3 страницы приложения: выполнить поиск, удалить заявку, перейти по url удаленной заявки, добавить две услуги в заявку (изменение карточки корзины), содержимое заявки.
3.  Показать в БД запросом результаты логического удаления и новую заявку.
4.  В БД изменить поля по теме в заявке и м-м и показать их в приложении.
5.  В коде показать модели, составной уникальный ключ м-м, 4 контроллера через ORM, а удаление заявки через SQL UPDATE.

**Контрольные вопросы:** виды БД, SQL запросы, курсоры, ORM, модель и миграции, чистая архитектура

**ER диаграмма:** сделать в StarUML; таблицы, связи, столбцы, типы столбцов и их длина, первичные, внешние ключи

**Задание:** Создание базы данных PostgreSQL по теме работы, подключение БД к созданным трем шаблонам

---

### Техническое задание

Необходимо разработать структуру БД по выбранной теме и ее реализовать с учетом требований ниже. Использовать таблицу услуг в страницах разработанноготельного приложения. Наполнить таблицы БД данными через админку Django или Adminer.

Получение и поиск услуг, добавление услуги в текущую заявку (статус черновик она же "корзина"), а также просмотр этой заявки сделать через ORM. Для страницы текущей заявки добавить кнопку логического удаления заявки (статус меняется на удален) с помощью выполнения SQL запроса UPDATE, без ORM. Всего пять HTTP методов: три GET и один POST добавления в заявку через ORM, еще один POST для удаления заявки через SQL.

При отсутствии заявки в статусе черновик у пользователя, она создается только при добавлении услуги в заявку. Если такая заявка уже есть, то услуга добавляется сразу в нее. Удаленные заявки просматривать нельзя, если у пользователя нет текущей заявки, ее карточка на странице услуг не активна.

### Требования к БД

Обязательно наличие 4 таблиц (каскадное удаление запрещено!):

1.  **Таблица услуг** (наименование, описание, статус удален/действует, url к изображению Nullable, поля по предметной области)
2.  **Таблица заявок** (только 4 поля NotNull: id, статус, дата создания datetime, создатель; дата формирования (2 действия создателя) datetime, дата завершения (2 действия модератора) datetime и модератор, поля по предметной области)
3.  **Таблица м-м заявки-услуги** (составной уникальный ключ, дополнительные поля количества/порядка/главный/другое)
4.  **Таблица пользователей** (для Django обязательно использовать системную таблицу, НЕ свою: логин, пароль, признак модератора)

Обязательно наличие 5 или более статусов заявок: черновик, удалён, сформирован, завершён, отклонён. У каждого пользователя не более одной заявки в статусе черновик. Названия таблиц и их полей должны соответствовать предметной области. Одно из доп. полей заявки или м-м рассчитывается при завершении заявки.

---

### Методические указания
- [Установка в Docker и использование PostgreSQL](https://github.com/iu5git/Web/blob/main/tutorials/lab2-db/README.md)
- [Курс](https://iu5edu.ru/wiki/devops/docs/master-classes/postgresql/) по основам PostgreSQL. [Лабораторные] (https://github.com/iu5git/Database) по PostgreSQL, индексы, Tauri, чат-бот]
- [Методические указания Django](https://github.com/iu5git/Web/blob/main/tutorials/lab2-py/lab2_tutorial.md)
- [Методические указания Golang](https://github.com/iu5git/Web/blob/main/tutorials/lab2-go/README.md). Видео мастер-класс [gORM и шаблоны Golang](https://vk.com/video-211704031_456239173)